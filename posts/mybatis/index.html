<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>MyBatis介绍及使用</title>
    <meta name="description" content="已識乾坤大，猶憐草木青">
    <meta name="keywords" content='blog, gokarna, hugo, Java, MyBatis, 框架'>

    <meta property="og:url" content="https://crazyyzw.top/posts/mybatis/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="MyBatis介绍及使用">
    <meta property="og:description" content="已識乾坤大，猶憐草木青">
    <meta property="og:image" content="https://crazyyzw.top/images/mona-loading-default.gif">
    <meta property="og:image:secure_url" content="https://crazyyzw.top/images/mona-loading-default.gif">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MyBatis介绍及使用">
    <meta name="twitter:description" content="已識乾坤大，猶憐草木青">
    <meta property="twitter:domain" content="https://crazyyzw.top/posts/mybatis/">
    <meta property="twitter:url" content="https://crazyyzw.top/posts/mybatis/">
    <meta name="twitter:image" content="https://crazyyzw.top/images/mona-loading-default.gif">

    
    <link rel="canonical" href="https://crazyyzw.top/posts/mybatis/" />

    <link rel="stylesheet" type="text/css" href="https://crazyyzw.top/css/normalize.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" type="text/css" href="https://crazyyzw.top/css/main.css">
	<link rel="stylesheet" type="text/css" href="https://crazyyzw.top/css/font-awesome.css">
	<link rel="stylesheet" type="text/css" href="https://crazyyzw.top/css/cropper.css">
	<link rel="stylesheet" type="text/css" href="https://crazyyzw.top/css/cube.css">
    <link disabled id="dark-theme" rel="stylesheet" href="https://crazyyzw.top/css/dark.css">

    <script src="https://crazyyzw.top/js/svg-injector.min.js"></script>
    <script src="https://crazyyzw.top/js/feather-icons.min.js"></script>
    <script src="https://crazyyzw.top/js/main.js"></script>
	<script src="https://crazyyzw.top/js/cropper.js"></script>
	<script src="https://crazyyzw.top/js/snowy.js"></script>
	<script src="https://crazyyzw.top/js/l2dwidget.min.js"></script>
	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
        <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          // customised options
          // • auto-render specific keys, e.g.:
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
          ],
          // • rendering keys, e.g.:
          throwOnError : false
        });
      });
    </script>
  
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">

        
        <div class="avatar">
            <a href="https://crazyyzw.top">
                <img src="https://crazyyzw.top/images/mona-loading-default.gif" alt="avatar" />
            </a>
        </div>
        

        <div class="nav-title">
            <a class="nav-brand" href="https://crazyyzw.top">Yangzw</a>
        </div>

        <div class="nav-links">
            
            <div class="nav-link">
                <a href="https://crazyyzw.top/"><span data-feather='home'></span> 首页 </a>
            </div>
            
            <div class="nav-link">
                <a href="https://crazyyzw.top/posts/"><span data-feather='book'></span> 归档 </a>
            </div>
            
            <div class="nav-link">
                <a href="https://crazyyzw.top/tags/"><span data-feather='tag'></span> 标签 </a>
            </div>
            
            <div class="nav-link">
                <a href="https://crazyyzw.top"><span data-feather='github'></span>  </a>
            </div>
            
            <div class="nav-link">
                <a href="https://crazyyzw.top/index.xml"><span data-feather='rss'></span>  </a>
            </div>
            

            <span class="nav-icons-divider"></span>
            <div class="nav-link dark-theme-toggle">
                <span id="dark-theme-toggle-screen-reader-target" class="sr-only"></span>
                <a>
                    <span id="theme-toggle-icon" data-feather="moon"></span>
                </a>
            </div>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">
                
                <li class="nav-item">
                    <a href="https://crazyyzw.top/"><span data-feather='home'></span> 首页 </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://crazyyzw.top/posts/"><span data-feather='book'></span> 归档 </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://crazyyzw.top/tags/"><span data-feather='tag'></span> 标签 </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://crazyyzw.top"><span data-feather='github'></span>  </a>
                </li>
                
                <li class="nav-item">
                    <a href="https://crazyyzw.top/index.xml"><span data-feather='rss'></span>  </a>
                </li>
                
                <li class="nav-item dark-theme-toggle">
                    <span id="dark-theme-toggle-screen-reader-target" class="sr-only">theme</span>
                    <a>
                        <span id="theme-toggle-icon" data-feather="moon"></span>
                    </a>
                </li>
            </ul>

        </div>
    </nav>
	<div id="ww_a15bb06dd16cc" v='1.3' loc='auto' a='{"t":"ticker","lang":"zh","sl_lpl":1,"ids":[],"font":"Arial","sl_ics":"one_a","sl_sot":"celsius","cl_bkg":"image","cl_font":"#FFFFFF","cl_cloud":"#FFFFFF","cl_persp":"#81D4FA","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722"}'><a href="https://weatherwidget.org/zh/" id="ww_a15bb06dd16cc_u" target="_blank">天气插件</a></div><script async src="https://app1.weatherwidget.org/js/?id=ww_a15bb06dd16cc"></script>
	<div class="cube">
		<div class="picture-outbox">
			<div class="out-top"><img src="https://source.unsplash.com/50x50/?comics" alt=""></div>
			<div class="out-bottom"><img src="https://source.unsplash.com/50x50/?cartoon" alt=""></div>
			<div class="out-left"><img src="https://source.unsplash.com/50x50/?animation" alt=""></div>
			<div class="out-right"><img src="https://source.unsplash.com/50x50/?Anime" alt=""></div>
			<div class="out-front"><img src="https://source.unsplash.com/50x50/?anime" alt=""></div>
			<div class="out-back"><img src="https://source.unsplash.com/50x50/?landscape" alt=""></div>
		</div>
	</div>
</header><main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>MyBatis介绍及使用</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            April 15, 2022
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://crazyyzw.top/tags/java">Java</a></li>
        
            <li class="post-tag"><a href="https://crazyyzw.top/tags/mybatis">MyBatis</a></li>
        
            <li class="post-tag"><a href="https://crazyyzw.top/tags/%E6%A1%86%E6%9E%B6">框架</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <h2 id="一什么是mybatis">一、什么是MyBatis？</h2>
<p><strong>MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</strong></p>
<h3 id="1mybatis衍生工具">1.MyBatis衍生工具</h3>
<p>MyBatis-Plus：是一个MyBatis增强工具，在MyBatis的基础上只做增强不做改变，为简化开发、提高效率而生。</p>
<p>TkMyBatis：是基于 Mybatis 框架开发的一个工具，通过调用它提供的方法实现对单表的数据操作，不需要写任何 sql 语句，这极大地提高了项目开发效率。</p>
<h3 id="2mybatis引入">2.MyBatis引入</h3>
<p>1.可以通过下载mybatis的jar包置于类路径(classpath)中</p>
<p>2.单独使用MyBatis加入pom依赖：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>org.mybatis<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>mybatis<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>x.x.x<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>3.集成SpringBoot中pom依赖：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>org.mybatis.spring.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>x.x.x<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id="二mybatis使用">二、MyBatis使用</h2>
<p>简单使用配置可以通过输入流（InputStream）实现：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;mybatis-config.xml的全限定名&gt;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>InputStream inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>SqlSessionFactory sqlSessionFactory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
</span></span></code></pre></div><p>也可以通过XML构建SqlSessionFactory：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE configuration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">&lt;!--根据需要进行配置--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>不使用XML构建SQLSessionFactory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>DataSource dataSource <span style="color:#f92672">=</span> BlogDataSourceFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBlogDataSource</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>TransactionFactory transactionFactory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JdbcTransactionFactory<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>Environment environment <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Environment<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">,</span> transactionFactory<span style="color:#f92672">,</span> dataSource<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>Configuration configuration <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Configuration<span style="color:#f92672">(</span>environment<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>configuration<span style="color:#f92672">.</span><span style="color:#a6e22e">addMapper</span><span style="color:#f92672">(</span>BlogMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>SqlSessionFactory sqlSessionFactory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>configuration<span style="color:#f92672">);</span>
</span></span></code></pre></div><p>SpringBoot集成MyBatis中，可以用SqlSessionFactoryBean替代SqlSessionFactory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>SqlSessionFactoryBean sessionFactory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBean<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>sessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setDataSource</span><span style="color:#f92672">(</span>dataSource<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>sessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setTypeAliasesPackage</span><span style="color:#f92672">(</span>typeAliasesPackage<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**根据需要进行配置*/</span>
</span></span></code></pre></div><h3 id="1获取sqlsession对数据库进行操作">1.获取SqlSession对数据库进行操作</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span><span style="color:#f92672">(</span>SqlSession session <span style="color:#f92672">=</span> sqlSessionFacory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>    XXXMapper mapper <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>XXXMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    XXX xxx <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">select</span><span style="color:#f92672">(</span><span style="color:#ae81ff">123</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="2mybatis的映射">2.MyBatis的映射</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE mapper
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;org.mybatis.com.UserMapper&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;selectUser&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;User&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    select * from user where id = #{id}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/select&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/mapper&gt;</span>
</span></span></code></pre></div><p>xml方式不依赖于字符串字面值，相较与下面这种映射方式更安全：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>User user <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>User<span style="color:#f92672">)</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">selectOne</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;org.mybatis.com.UserMapper.selectUser&#34;</span><span style="color:#f92672">,</span><span style="color:#ae81ff">123</span><span style="color:#f92672">);</span>
</span></span></code></pre></div><p>通过java注解进行配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserMapper</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SELECT * FROM user WHERE id = #{id}&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  Blog <span style="color:#a6e22e">selectUser</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="1-sqlsessionfactorybuilder">1) SqlSessionFactoryBuilder</h4>
<p>这个类可以被实例化、使用和丢弃，一旦创建了 SqlSessionFactory，就不再需要它了。 因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。 你可以重用 SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，但最好还是不要一直保留着它，以保证所有的 XML 解析资源可以被释放给更重要的事情。</p>
<h4 id="2-sqlsessionfactory">2) SqlSessionFactory</h4>
<p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例。 使用 SqlSessionFactory 的最佳实践是在应用运行期间不要重复创建多次，多次重建 SqlSessionFactory 被视为一种代码“坏习惯”。因此 SqlSessionFactory 的最佳作用域是应用作用域。 有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p>
<h4 id="3-sqlsession">3) SqlSession</h4>
<p>每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。 如果你现在正在使用一种 Web 框架，考虑将 SqlSession 放在一个和 HTTP 请求相似的作用域中。 换句话说，每次收到 HTTP 请求，就可以打开一个 SqlSession，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 finally 块中。 下面的示例就是一个确保 SqlSession 关闭的标准模式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>SqlSession session <span style="color:#f92672">=</span> sqlSessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 你的应用逻辑代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>映射器实例（Mapper）</p>
<p>映射器是一些绑定映射语句的接口。映射器接口的实例是从 SqlSession 中获得的。虽然从技术层面上来讲，任何映射器实例的最大作用域与请求它们的 SqlSession 相同。但方法作用域才是映射器实例的最合适的作用域。 也就是说，映射器实例应该在调用它们的方法中被获取，使用完毕之后即可丢弃。 映射器实例并不需要被显式地关闭。尽管在整个请求作用域保留映射器实例不会有什么问题，但是你很快会发现，在这个作用域上管理太多像 SqlSession 的资源会让你忙不过来。 因此，最好将映射器放在方法作用域内。就像下面的例子一样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> <span style="color:#f92672">(</span>SqlSession session <span style="color:#f92672">=</span> sqlSessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  BlogMapper mapper <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>BlogMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 你的应用逻辑代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="三xml配置">三、XML配置</h2>
<p>xml标签结构：</p>
<ul>
<li>configuration（配置）
<ul>
<li>properties（属性）</li>
<li>settings（设置）</li>
<li>typeAliases（类型别名）</li>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）</li>
<li>environments（环境配置）
<ul>
<li>environment（环境变量）
<ul>
<li>transactionManager（事务管理器）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li>databaseIdProvider（数据库厂商标识）</li>
<li>mappers（映射器）</li>
</ul>
</li>
</ul>
<h3 id="1属性properties">1.属性（properties）</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;properties</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;org/mybatis/example/config.properties&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;dataSource</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;driver&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${driver}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${url}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${username}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${password}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/dataSource&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/properties&gt;</span>
</span></span></code></pre></div><p>可以通过修改config.properties动态进行修改配置。</p>
<p>也可以通过java代码来进行属性的设置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>reader<span style="color:#f92672">,</span> props<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ... 或者 ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>reader<span style="color:#f92672">,</span> environment<span style="color:#f92672">,</span> props<span style="color:#f92672">);</span>
</span></span></code></pre></div><p>若属性在多个地方进行配置，其加载优先顺序是：优先读取properties给定的值，再是读取动态占位符获取properties文件里值，最后则是读取java代码传参方式配置的值。</p>
<h3 id="2设置settings">2.设置（settings）</h3>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>设置名</strong></th>
<th style="text-align:center"><strong>描述</strong></th>
<th style="text-align:center"><strong>默认值</strong></th>
<th style="text-align:center"><strong>有效值</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">cacheEnabled</td>
<td style="text-align:center">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">lazyLoadingEnabled</td>
<td style="text-align:center">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">aggressiveLazyLoading</td>
<td style="text-align:center">开启时，任一方法的调用都会加载该对象的所有延迟加载属性。 否则，每个延迟加载属性会按需加载</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">multipleResultSetsEnabled</td>
<td style="text-align:center">是否允许单个语句返回多结果集（需要数据库驱动支持）</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">useColumnLabel</td>
<td style="text-align:center">使用列标签代替列名。实际表现依赖于数据库驱动，具体可参考数据库驱动的相关文档，或通过对比测试来观察</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">useGeneratedKeys</td>
<td style="text-align:center">允许 JDBC 支持自动生成主键，需要数据库驱动支持。如果设置为 true，将强制使用自动生成主键。尽管一些数据库驱动不支持此特性，但仍可正常工作（如 Derby）</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">autoMappingBehavior</td>
<td style="text-align:center">指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示关闭自动映射；PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 FULL 会自动映射任何复杂的结果集（无论是否嵌套）</td>
<td style="text-align:center">PARTIAL</td>
<td style="text-align:center">NONE|PARTIAL|FULL</td>
</tr>
<tr>
<td style="text-align:center">autoMappingUnknownColumnBehavior</td>
<td style="text-align:center">指定发现自动映射目标未知列（或未知属性类型）的行为。NONE表示不做任何反应，WARNING表示输出警告日志，FAILING表示映射失败</td>
<td style="text-align:center">NONE</td>
<td style="text-align:center">NONE|WARNING|FAILNG</td>
</tr>
<tr>
<td style="text-align:center">defaultExecutorType</td>
<td style="text-align:center">配置默认的执行器，SIMPLE就是普通的执行器；PEUSE执行器会重用预处理语句；BATCH执行器不仅重用语句还会执行批量更新</td>
<td style="text-align:center">SIMPLE</td>
<td style="text-align:center">SIMPLE|REUSE|BATCH</td>
</tr>
<tr>
<td style="text-align:center">defaultStatementTimeout</td>
<td style="text-align:center">设置超时时间，它决定数据库驱动等待数据库响应的秒数</td>
<td style="text-align:center">未设置</td>
<td style="text-align:center">任意正整数</td>
</tr>
<tr>
<td style="text-align:center">safeRowBoundsEnabled</td>
<td style="text-align:center">是否允许在嵌套语句中使用分页（RowBounds）。如果允许使用则设置为 false</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">safeResultHandlerEnabled</td>
<td style="text-align:center">是否允许在嵌套语句中使用结果处理器（ResultHandler）。如果允许使用则设置为 false</td>
<td style="text-align:center">true</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">mapUnderscoreToCamelCase</td>
<td style="text-align:center">是否开启驼峰命名自动映射，即从经典数据库列名 A_COLUMN 映射到经典 Java 属性名 aColumn</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true</td>
</tr>
<tr>
<td style="text-align:center">lazyLoadTriggerMethods</td>
<td style="text-align:center">指定对象的哪些方法触发一次延迟加载</td>
<td style="text-align:center">equals,clone,hashCode,toString</td>
<td style="text-align:center">用逗号分隔的方法列表</td>
</tr>
<tr>
<td style="text-align:center">logPrefix</td>
<td style="text-align:center">指定 MyBatis 增加到日志名称的前缀</td>
<td style="text-align:center">未设置</td>
<td style="text-align:center">任何字符串</td>
</tr>
<tr>
<td style="text-align:center">logImpl</td>
<td style="text-align:center">指定 MyBatis 所用日志的具体实现，未指定时将自动查找</td>
<td style="text-align:center">未设置</td>
<td style="text-align:center">SLF4J|LOG4J2|JDK_LOGGING|COMMONS_LOGGING|NO_LOGGING</td>
</tr>
<tr>
<td style="text-align:center">shrinkWhitespacesInSql</td>
<td style="text-align:center">从SQL中删除多余的空格字符。请注意，这也会影响SQL中的文字字符串。 (新增于 3.5.5)</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true|false</td>
</tr>
<tr>
<td style="text-align:center">从SQL中删除多余的空格字符。请注意，这也会影响SQL中的文字字符串。 (新增于 3.5.5)</td>
<td style="text-align:center">为 &lsquo;foreach&rsquo; 标签的 &rsquo;nullable&rsquo; 属性指定默认值。（新增于 3.5.9）</td>
<td style="text-align:center">false</td>
<td style="text-align:center">true|false</td>
</tr>
</tbody>
</table>
<p>settings示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;settings&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;cacheEnabled&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;lazyLoadingEnabled&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;multipleResultSetsEnabled&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;useColumnLabel&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;useGeneratedKeys&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;autoMappingBehavior&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;PARTIAL&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;autoMappingUnknownColumnBehavior&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;WARNING&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;defaultExecutorType&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;SIMPLE&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;defaultStatementTimeout&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;25&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;defaultFetchSize&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;100&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;safeRowBoundsEnabled&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;mapUnderscoreToCamelCase&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;localCacheScope&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;SESSION&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jdbcTypeForNull&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;OTHER&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;lazyLoadTriggerMethods&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;equals,clone,hashCode,toString&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/settings&gt;</span>
</span></span></code></pre></div><h3 id="3类型别名typealiases">3.类型别名（typeAliases）</h3>
<p>指定实体类别名：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;typeAliases&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;Author&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;domain.blog.Author&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;Blog&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;domain.blog.Blog&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;Comment&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;domain.blog.Comment&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;Post&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;domain.blog.Post&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;Section&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;domain.blog.Section&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;Tag&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;domain.blog.Tag&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/typeAliases&gt;</span>
</span></span></code></pre></div><p>指定包名，来给实体类起别名：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;typeAliases&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;package</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;domain.blog&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/typeAliases&gt;</span>
</span></span></code></pre></div><p>若指定包下实体类没有@Alias注解起别名，则会使用Bean首字母小写的非限定类名来作为它的别名。若有，则Java代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Alias</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yzw&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Author</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">。。。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>java类型内建的类型别名，区分大小</p>
<table>
<thead>
<tr>
<th style="text-align:center">别名</th>
<th style="text-align:center">映射的类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">_byte</td>
<td style="text-align:center">byte</td>
</tr>
<tr>
<td style="text-align:center">_char</td>
<td style="text-align:center">char</td>
</tr>
<tr>
<td style="text-align:center">_long</td>
<td style="text-align:center">long</td>
</tr>
<tr>
<td style="text-align:center">_short</td>
<td style="text-align:center">short</td>
</tr>
<tr>
<td style="text-align:center">_int</td>
<td style="text-align:center">int</td>
</tr>
<tr>
<td style="text-align:center">_integer</td>
<td style="text-align:center">int</td>
</tr>
<tr>
<td style="text-align:center">_double</td>
<td style="text-align:center">double</td>
</tr>
<tr>
<td style="text-align:center">_float</td>
<td style="text-align:center">float</td>
</tr>
<tr>
<td style="text-align:center">_boolean</td>
<td style="text-align:center">boolean</td>
</tr>
<tr>
<td style="text-align:center">string</td>
<td style="text-align:center">String</td>
</tr>
<tr>
<td style="text-align:center">byte</td>
<td style="text-align:center">Byte</td>
</tr>
<tr>
<td style="text-align:center">char</td>
<td style="text-align:center">Character</td>
</tr>
<tr>
<td style="text-align:center">character</td>
<td style="text-align:center">Character</td>
</tr>
<tr>
<td style="text-align:center">long</td>
<td style="text-align:center">Long</td>
</tr>
<tr>
<td style="text-align:center">short</td>
<td style="text-align:center">Short</td>
</tr>
<tr>
<td style="text-align:center">int</td>
<td style="text-align:center">Integer</td>
</tr>
<tr>
<td style="text-align:center">integer</td>
<td style="text-align:center">Integer</td>
</tr>
<tr>
<td style="text-align:center">double</td>
<td style="text-align:center">Double</td>
</tr>
<tr>
<td style="text-align:center">float</td>
<td style="text-align:center">Float</td>
</tr>
<tr>
<td style="text-align:center">boolean</td>
<td style="text-align:center">Boolean</td>
</tr>
<tr>
<td style="text-align:center">date</td>
<td style="text-align:center">Date</td>
</tr>
<tr>
<td style="text-align:center">decimal</td>
<td style="text-align:center">BigDecimal</td>
</tr>
<tr>
<td style="text-align:center">bigdecimal</td>
<td style="text-align:center">BigDecimal</td>
</tr>
<tr>
<td style="text-align:center">object</td>
<td style="text-align:center">Object</td>
</tr>
<tr>
<td style="text-align:center">date[]</td>
<td style="text-align:center">Date[]</td>
</tr>
<tr>
<td style="text-align:center">decimal[]</td>
<td style="text-align:center">BigDecimal[]</td>
</tr>
<tr>
<td style="text-align:center">bigdecimal[]</td>
<td style="text-align:center">BigDecimal[]</td>
</tr>
<tr>
<td style="text-align:center">biginteger[]</td>
<td style="text-align:center">BigInteger[]</td>
</tr>
<tr>
<td style="text-align:center">object[]</td>
<td style="text-align:center">Object[]</td>
</tr>
<tr>
<td style="text-align:center">map</td>
<td style="text-align:center">Map</td>
</tr>
<tr>
<td style="text-align:center">hashmap</td>
<td style="text-align:center">HashMap</td>
</tr>
<tr>
<td style="text-align:center">list</td>
<td style="text-align:center">List</td>
</tr>
<tr>
<td style="text-align:center">arraylist</td>
<td style="text-align:center">ArrayList</td>
</tr>
<tr>
<td style="text-align:center">collection</td>
<td style="text-align:center">Collection</td>
</tr>
<tr>
<td style="text-align:center">iterator</td>
<td style="text-align:center">Iterator</td>
</tr>
</tbody>
</table>
<h3 id="4对象工厂objectfacotry">4.对象工厂（objectFacotry）</h3>
<p>每次 MyBatis 创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成实例化工作。 默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认无参构造方法，要么通过存在的参数映射来调用带有参数的构造方法。 如果想覆盖对象工厂的默认行为，可以通过创建自己的对象工厂来实现。比如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleObjectFactory</span> <span style="color:#66d9ef">extends</span> DefaultObjectFactory <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">create</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> type<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span>type<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">create</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> type<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Class<span style="color:#f92672">&lt;?&gt;&gt;</span> constructorArgTypes<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> constructorArgs<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span>type<span style="color:#f92672">,</span> constructorArgTypes<span style="color:#f92672">,</span> constructorArgs<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setProperties</span><span style="color:#f92672">(</span>Properties properties<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setProperties</span><span style="color:#f92672">(</span>properties<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isCollection</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> type<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Collection<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>type<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- mybatis-config.xml --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;objectFactory</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;org.mybatis.example.ExampleObjectFactory&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;someProperty&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;100&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/objectFactory&gt;</span>
</span></span></code></pre></div><p>ObjectFactory 接口很简单，它包含两个创建实例用的方法，一个是处理默认无参构造方法的，另外一个是处理带参数的构造方法的。 另外，setProperties 方法可以被用来配置 ObjectFactory，在初始化你的 ObjectFactory 实例后， objectFactory 元素体中定义的属性会被传递给 setProperties 方法。</p>
<h3 id="5环境配置environments">5.环境配置（environments）</h3>
<p>MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中， 现实情况下有多种理由需要这么做。例如，开发、测试和生产环境需要有不同的配置；或者想在具有相同 Schema 的多个生产数据库中使用相同的 SQL 映射。还有许多类似的使用场景。不过，尽管可以配置多个环境，但每个SqlSessionFactory实例，每个数据库对应一个。而如果是三个数据库，就需要三个实例，依次类推，记起来很简单。</p>
<p>每个数据库对应一个SqlSessionFactory实例，为了指定创建那种环境，只需要将它作为可选参数传递给SqlSessionFactoryBuilder即可。可以接受环境配置的两个方法签名是：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>reader<span style="color:#f92672">,</span> environment<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>reader<span style="color:#f92672">,</span> environment<span style="color:#f92672">,</span> properties<span style="color:#f92672">);</span>
</span></span></code></pre></div><p>如果忽略了环境参数，那么将会加载默认环境，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>reader<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>reader<span style="color:#f92672">,</span> properties<span style="color:#f92672">);</span>
</span></span></code></pre></div><p>environments元素定义了如何配置环境：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;environments</span> <span style="color:#a6e22e">default=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;environment</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;transactionManager</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;JDBC&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;...&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/transactionManager&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;dataSource</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;driver&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${driver}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${url}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${username}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${password}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/dataSource&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/environment&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/environments&gt;</span>
</span></span></code></pre></div><h3 id="6映射器mappers">6.映射器（mappers）</h3>
<p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以最好的办法是直接告诉 MyBatis 到哪里去找映射文件。 你可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 <code>file:///</code> 形式的 URL），或类名和包名等。例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;mappers&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;org/mybatis/builder/AuthorMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;org/mybatis/builder/BlogMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;org/mybatis/builder/PostMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/mappers&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;mappers&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">url=</span><span style="color:#e6db74">&#34;file:///var/mappers/AuthorMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">url=</span><span style="color:#e6db74">&#34;file:///var/mappers/BlogMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">url=</span><span style="color:#e6db74">&#34;file:///var/mappers/PostMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/mappers&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;mappers&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.mybatis.builder.AuthorMapper&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.mybatis.builder.BlogMapper&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.mybatis.builder.PostMapper&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/mappers&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;mappers&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;package</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.mybatis.builder&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/mappers&gt;</span>
</span></span></code></pre></div>
        </p>
        
    </div>

    <div class="prev-next">
        
    </div>
</div>

<aside class="post-toc">
    <nav id="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#一什么是mybatis">一、什么是MyBatis？</a>
          <ul>
            <li><a href="#1mybatis衍生工具">1.MyBatis衍生工具</a></li>
            <li><a href="#2mybatis引入">2.MyBatis引入</a></li>
          </ul>
        </li>
        <li><a href="#二mybatis使用">二、MyBatis使用</a>
          <ul>
            <li><a href="#1获取sqlsession对数据库进行操作">1.获取SqlSession对数据库进行操作</a></li>
            <li><a href="#2mybatis的映射">2.MyBatis的映射</a>
              <ul>
                <li><a href="#1-sqlsessionfactorybuilder">1) SqlSessionFactoryBuilder</a></li>
                <li><a href="#2-sqlsessionfactory">2) SqlSessionFactory</a></li>
                <li><a href="#3-sqlsession">3) SqlSession</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#三xml配置">三、XML配置</a>
          <ul>
            <li><a href="#1属性properties">1.属性（properties）</a></li>
            <li><a href="#2设置settings">2.设置（settings）</a></li>
            <li><a href="#3类型别名typealiases">3.类型别名（typeAliases）</a></li>
            <li><a href="#4对象工厂objectfacotry">4.对象工厂（objectFacotry）</a></li>
            <li><a href="#5环境配置environments">5.环境配置（environments）</a></li>
            <li><a href="#6映射器mappers">6.映射器（mappers）</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
</aside>



    

        </main><footer class="footer">
    
    


	
	<span id="busuanzi_container_site_pv" >&copy; 2023 &nbsp; 黄粱一梦
		&#128122;<span id="busuanzi_value_site_uv" style="display:inline"></span>
    </span>
	
</footer></body>
</html>
